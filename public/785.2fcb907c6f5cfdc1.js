"use strict";(self.webpackChunkMeuBilhete_NewSite=self.webpackChunkMeuBilhete_NewSite||[]).push([[785],{1785:(Te,b,m)=>{m.r(b),m.d(b,{PaymentMethodModule:()=>Ze});var h=m(9808),g=m(5861),P=m(7579),v=m(2722),_=m(262),C=m(9646),s=m(3075),A=m(2340),M=m(7445),e=m(5e3),q=m(7217),f=m(3287),Z=m(5970),S=m(7556),I=m(756),k=m(3254),N=m(5307);const w=["mpSessionId"],F=["qrCodeInput"];function U(r,d){1&r&&(e.TgZ(0,"div"),e._UZ(1,"i",61),e.qZA())}function O(r,d){if(1&r&&(e.TgZ(0,"i",62),e._UZ(1,"img",63),e.qZA()),2&r){const t=e.oxw(5);e.xp6(1),e.MGl("src","https://www.mercadopago.com/org-img/MP3/API/logos/",t.selectedCard,".gif",e.LSH)}}function E(r,d){1&r&&(e.TgZ(0,"option",64),e._uU(1,"Aguardando cart\xe3o"),e.qZA())}function J(r,d){if(1&r&&(e.TgZ(0,"option",66),e._uU(1),e.qZA()),2&r){const t=d.$implicit;e.s9C("value",t.installments),e.xp6(1),e.Oqu(t.recommended_message)}}function R(r,d){if(1&r&&e.YNc(0,J,2,2,"option",65),2&r){const t=e.oxw(5);e.Q6J("ngForOf",t.installments)}}function Y(r,d){if(1&r){const t=e.EpF();e.TgZ(0,"div"),e.TgZ(1,"div",26),e.TgZ(2,"h2",27),e.TgZ(3,"button",28),e.NdJ("click",function(){e.CHM(t);const a=e.oxw().$implicit;return e.oxw(3).selectPaymentMethod(a.gateway,a.name,a.id)}),e.TgZ(4,"div",29),e.TgZ(5,"span",30),e._uU(6,"Cart\xe3o de cr\xe9dito"),e.qZA(),e._UZ(7,"img",31),e.qZA(),e.qZA(),e.qZA(),e.TgZ(8,"div",32),e.TgZ(9,"form",33),e.TgZ(10,"div",34),e.TgZ(11,"div",4),e.TgZ(12,"div",35),e.TgZ(13,"span",36),e._uU(14,"N\xfamero do cart\xe3o"),e.qZA(),e.TgZ(15,"div",37),e.YNc(16,U,2,0,"div",0),e.YNc(17,O,2,1,"ng-template",null,38,e.W1O),e.TgZ(19,"input",39),e.NdJ("keyup",function(){return e.CHM(t),e.oxw(4).getCardInformation()})("input",function(){return e.CHM(t),e.oxw(4).getCardInformation()}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(20,"div",40),e.TgZ(21,"span",36),e._uU(22,"Validade"),e.qZA(),e.TgZ(23,"div",37),e._UZ(24,"i",41),e._UZ(25,"input",42),e.qZA(),e.qZA(),e.TgZ(26,"div",43),e.TgZ(27,"span",36),e._uU(28,"CVC/CVV"),e.qZA(),e.TgZ(29,"div",37),e._UZ(30,"i",44),e._UZ(31,"input",45),e.qZA(),e.qZA(),e.TgZ(32,"div",40),e.TgZ(33,"span",36),e._uU(34,"Titular"),e.qZA(),e.TgZ(35,"div",37),e._UZ(36,"i",46),e._UZ(37,"input",47),e.qZA(),e.qZA(),e.TgZ(38,"div",43),e.TgZ(39,"span",36),e._uU(40,"CPF "),e.qZA(),e.TgZ(41,"div",37),e._UZ(42,"i",48),e._UZ(43,"input",49),e.qZA(),e.qZA(),e.TgZ(44,"div",35),e.TgZ(45,"span",36),e._uU(46,"Parcelas"),e.qZA(),e.TgZ(47,"div",37),e._UZ(48,"i",50),e.TgZ(49,"select",51),e.NdJ("change",function(a){return e.CHM(t),e.oxw(4).getSelectedInstallments(a)}),e.YNc(50,E,2,0,"option",52),e.YNc(51,R,1,1,"ng-template",null,53,e.W1O),e.qZA(),e.qZA(),e.qZA(),e._UZ(53,"input",54),e._UZ(54,"input",55),e._UZ(55,"input",56),e.qZA(),e.TgZ(56,"span",57),e._UZ(57,"i",58),e._uU(58,"Compra 100% Segura"),e.qZA(),e.qZA(),e._UZ(59,"input",59,60),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&r){const t=e.MAs(18),i=e.MAs(52),a=e.oxw(4);e.xp6(9),e.Q6J("formGroup",a.creditCardForm),e.xp6(7),e.Q6J("ngIf",""==a.selectedCard)("ngIfElse",t),e.xp6(34),e.Q6J("ngIf",0==a.installments.length)("ngIfElse",i)}}function D(r,d){if(1&r&&(e.TgZ(0,"div"),e._UZ(1,"app-malga-credit-card",67),e.qZA()),2&r){const t=e.oxw().$implicit,i=e.oxw(3);e.xp6(1),e.Q6J("baseClass",i.thisClass)("paymentMethod",t)}}function B(r,d){1&r&&e._UZ(0,"div")}function V(r,d){1&r&&(e.ynx(0),e._UZ(1,"img",72),e.BQk())}function Q(r,d){1&r&&(e.ynx(0),e._UZ(1,"img",73),e.BQk())}function j(r,d){if(1&r&&(e.TgZ(0,"div",74),e.TgZ(1,"div",75),e._uU(2," Ao finalizar o pedido voc\xea ter\xe1 acesso ao QrCode! "),e.qZA(),e.qZA()),2&r){const t=e.oxw(4).index;e.MGl("id","pix",t,"")}}function L(r,d){if(1&r){const t=e.EpF();e.TgZ(0,"div",26),e.TgZ(1,"h2",69),e.TgZ(2,"button",70),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(3).$implicit;return e.oxw(3).selectPaymentMethod(a.gateway,a.name,a.id)}),e.TgZ(3,"div",29),e.TgZ(4,"span",30),e._uU(5),e.qZA(),e.YNc(6,V,2,0,"ng-container",2),e.YNc(7,Q,2,0,"ng-container",2),e.qZA(),e.qZA(),e.qZA(),e.YNc(8,j,3,1,"div",71),e.qZA()}if(2&r){const t=e.oxw(3),i=t.index,a=t.$implicit,o=e.oxw(3);e.xp6(2),e.uIk("data-bs-target","#pix"+i),e.xp6(3),e.Oqu(a.name),e.xp6(1),e.Q6J("ngIf",-1!=a.gateway.indexOf("Pix")),e.xp6(1),e.Q6J("ngIf","PicPay"==a.gateway),e.xp6(1),e.Q6J("ngIf",0==o.disabledAllButNotCard)}}function W(r,d){if(1&r&&(e.TgZ(0,"div"),e.YNc(1,L,9,5,"div",68),e.qZA()),2&r){const t=e.oxw(5);e.xp6(1),e.Q6J("ngIf",0==t.disabledAllButNotCard)}}function $(r,d){if(1&r&&e.YNc(0,W,2,1,"div",2),2&r){const t=e.oxw().$implicit;e.Q6J("ngIf","MercadoPagoPix"==t.gateway||"MalgaPix"==t.gateway||"PagSeguroPix"==t.gateway||"PicPay"==t.gateway)}}function z(r,d){if(1&r&&(e.TgZ(0,"div"),e.YNc(1,Y,61,5,"div",2),e.YNc(2,D,2,2,"div",2),e.YNc(3,B,1,0,"div",0),e.YNc(4,$,1,1,"ng-template",null,25,e.W1O),e.qZA()),2&r){const t=d.$implicit,i=e.MAs(5),a=e.oxw(3);e.xp6(1),e.Q6J("ngIf","MercadoPagoCreditCard"==t.gateway),e.xp6(1),e.Q6J("ngIf","MalgaCreditCard"==t.gateway),e.xp6(1),e.Q6J("ngIf","e6a772ac-5a35-4724-988d-ad2a648b7ec1"==a.eventId&&null!=a.ticketTags)("ngIfElse",i)}}function H(r,d){if(1&r&&(e.TgZ(0,"div",22),e.TgZ(1,"p",7),e._uU(2,"Escolha o m\xe9todo de pagamento"),e.qZA(),e.TgZ(3,"div",23),e.TgZ(4,"div",24),e.YNc(5,z,6,4,"div",15),e.qZA(),e.qZA(),e.qZA()),2&r){const t=e.oxw(2);e.xp6(5),e.Q6J("ngForOf",t.paymentMethods)}}function G(r,d){if(1&r&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&r){const t=e.oxw(2);e.xp6(1),e.hij("Pr\xe9-venda realizada por ",t.comissionerName,"")}}function X(r,d){if(1&r&&(e.TgZ(0,"p",79),e._uU(1),e.qZA()),2&r){const t=e.oxw().$implicit;e.xp6(1),e.hij("Lugar: ",t.placeName,"")}}function K(r,d){if(1&r&&(e.TgZ(0,"tr"),e.TgZ(1,"td",76),e.TgZ(2,"p",77),e._uU(3),e.qZA(),e.YNc(4,X,2,1,"p",78),e.TgZ(5,"p",79),e._uU(6),e.qZA(),e.qZA(),e.TgZ(7,"td",80),e._uU(8),e.qZA(),e.TgZ(9,"td",81),e._uU(10),e.ALo(11,"number"),e.qZA(),e.qZA()),2&r){const t=d.$implicit,i=e.oxw(2);e.xp6(3),e.Oqu(t.name),e.xp6(1),e.Q6J("ngIf",t.placeName),e.xp6(2),e.Oqu(t.batch),e.xp6(2),e.Oqu(i.countTickets(t.id,t.placeName)),e.xp6(2),e.hij("R$ ",e.xi3(11,5,i.amount(t),"1.2-2"),"")}}function ee(r,d){if(1&r&&(e.TgZ(0,"p",82),e._uU(1,"Forma de pagamento escolhida: "),e.TgZ(2,"b"),e._uU(3),e.qZA(),e.qZA()),2&r){const t=e.oxw(2);e.xp6(3),e.Oqu(t.paymentMethodName)}}function te(r,d){1&r&&(e.TgZ(0,"div"),e._UZ(1,"app-spinner",85),e.qZA())}function ie(r,d){1&r&&e._uU(0," Finalizar pedido ")}function re(r,d){if(1&r){const t=e.EpF();e.TgZ(0,"div"),e.TgZ(1,"button",83),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).startOrder()}),e.YNc(2,te,2,0,"div",0),e.YNc(3,ie,1,0,"ng-template",null,84,e.W1O),e.qZA(),e.qZA()}if(2&r){const t=e.MAs(4),i=e.oxw(2);e.xp6(1),e.Q6J("disabled",1==i.loading||i.paymentMethod&&-1!=i.paymentMethod.toLowerCase().indexOf("creditcard")&&""==i.selectedCard),e.xp6(1),e.Q6J("ngIf",1==i.loading)("ngIfElse",t)}}function ae(r,d){if(1&r&&(e.TgZ(0,"div"),e.TgZ(1,"div",3),e.TgZ(2,"div",4),e.YNc(3,H,6,1,"div",5),e.TgZ(4,"div",6),e.TgZ(5,"p",7),e._uU(6,"Detalhes da compra"),e.qZA(),e.YNc(7,G,2,1,"p",2),e.TgZ(8,"p",8),e._uU(9),e.qZA(),e.TgZ(10,"div",9),e.TgZ(11,"div",10),e.TgZ(12,"table",11),e.TgZ(13,"tbody"),e.TgZ(14,"tr"),e.TgZ(15,"th",12),e._uU(16,"Ingresso"),e.qZA(),e.TgZ(17,"th",13),e._uU(18,"Qtd"),e.qZA(),e.TgZ(19,"th",14),e._uU(20,"Valor"),e.qZA(),e.qZA(),e.YNc(21,K,12,8,"tr",15),e.TgZ(22,"tr"),e.TgZ(23,"td",16),e.TgZ(24,"p",17),e.TgZ(25,"strong"),e._uU(26,"Sub-total:"),e.qZA(),e._uU(27),e.ALo(28,"number"),e.qZA(),e.TgZ(29,"p",17),e.TgZ(30,"strong"),e._uU(31,"* Impostos e taxas:"),e.qZA(),e._uU(32),e.ALo(33,"number"),e.qZA(),e.TgZ(34,"p",18),e._uU(35),e.ALo(36,"number"),e.qZA(),e.TgZ(37,"p",19),e._uU(38,"* Taxas podem variar de acordo com a forma de pagamento"),e.qZA(),e.YNc(39,ee,4,1,"p",20),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(40,"div",21),e.YNc(41,re,5,3,"div",2),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&r){const t=e.oxw();e.xp6(3),e.Q6J("ngIf",t.amount()-t.fee()>0),e.xp6(4),e.Q6J("ngIf",""!==t.comissionerName),e.xp6(2),e.hij("Evento: ",t.eventName,""),e.xp6(12),e.Q6J("ngForOf",t.allTickets),e.xp6(6),e.hij("\xa0R$ ",e.xi3(28,9,t.amount()-t.fee(),"1.2-2"),""),e.xp6(5),e.hij("\xa0R$ ",e.xi3(33,12,t.totalFee,"1.2-2"),""),e.xp6(3),e.hij("Total:\xa0R$ ",e.xi3(36,15,t.totalAmount,"1.2-2"),""),e.xp6(4),e.Q6J("ngIf",null!=t.paymentMethodName),e.xp6(2),e.Q6J("ngIf",t.paymentMethod||0==t.totalAmount)}}function oe(r,d){if(1&r){const t=e.EpF();e.TgZ(0,"div"),e.TgZ(1,"div",86),e.TgZ(2,"p"),e._uU(3),e.qZA(),e.qZA(),e.TgZ(4,"div",87),e._UZ(5,"img",88),e.qZA(),e.TgZ(6,"div",89),e._UZ(7,"input",90,91),e.qZA(),e.TgZ(9,"div",92),e.TgZ(10,"button",93),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).copyQrCode()}),e._uU(11,"copiar chave"),e.qZA(),e.qZA(),e.qZA()}if(2&r){const t=e.oxw(2);e.xp6(3),e.hij(" Seu pedido #",t.numberOrder,' foi realizado com sucesso. Efetue o pagamento atrav\xe9s do PIX escolhendo a op\xe7\xe3o QR Code em seu banco e apontando a c\xe2mera do seu celular ou copie o c\xf3digo abaixo e pague atrav\xe9s da op\xe7\xe3o "PIX copia e cola". '),e.xp6(2),e.Q6J("src",t.qrCodeBase64,e.LSH),e.xp6(2),e.Q6J("ngModel",t.qrCode)}}function ne(r,d){if(1&r){const t=e.EpF();e.TgZ(0,"div"),e.TgZ(1,"div",86),e.TgZ(2,"p"),e._uU(3),e.qZA(),e.qZA(),e.TgZ(4,"div",87),e._UZ(5,"img",88),e.qZA(),e.TgZ(6,"div",89),e._UZ(7,"input",90,91),e.qZA(),e.TgZ(9,"div",92),e.TgZ(10,"button",93),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).copyQrCode()}),e._uU(11,"Copiar Chave"),e.qZA(),e.qZA(),e.qZA()}if(2&r){const t=e.oxw(2);e.xp6(3),e.hij(" Seu pedido #",t.numberOrder," foi realizado com sucesso. Efetue o pagamento pelo aplicativo do PicPay. "),e.xp6(2),e.Q6J("src",t.qrCodeBase64,e.LSH),e.xp6(2),e.Q6J("ngModel",t.qrCode)}}function se(r,d){if(1&r&&(e.TgZ(0,"div"),e.TgZ(1,"div",94),e.TgZ(2,"div",95),e.TgZ(3,"p",96),e._uU(4),e.qZA(),e.qZA(),e.TgZ(5,"div",97),e.TgZ(6,"p",98),e._uU(7),e.TgZ(8,"b",99),e._uU(9),e.qZA(),e._uU(10,"."),e.qZA(),e.TgZ(11,"p"),e._uU(12,"Voc\xea receber\xe1 um e-mail de confirma\xe7\xe3o de compra e, caso aprovado, tamb\xe9m receber\xe1 o voucher em seu e-mail."),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&r){const t=e.oxw(2);e.xp6(4),e.hij("Pagamento ",t.paymentWaitingType,""),e.xp6(3),e.hij("Seu pedido #",t.numberOrder," foi realizado com sucesso, mas ainda est\xe1 "),e.xp6(2),e.Oqu(t.paymentWaitingType)}}function de(r,d){if(1&r&&(e.TgZ(0,"div"),e.TgZ(1,"div",94),e.TgZ(2,"div",95),e.TgZ(3,"p",96),e._uU(4,"Pagamento aprovado"),e.qZA(),e.qZA(),e.TgZ(5,"div",97),e.TgZ(6,"p",98),e._uU(7),e.TgZ(8,"b",100),e._uU(9,"aprovado"),e.qZA(),e.qZA(),e.TgZ(10,"p"),e._uU(11,"Voc\xea receber\xe1 a confirma\xe7\xe3o da compra em seu e-mail"),e.qZA(),e.TgZ(12,"p"),e._uU(13,"Mas voc\xea tamb\xe9m pode acessar o voucher clicando no link abaixo:"),e.qZA(),e.qZA(),e.TgZ(14,"div",92),e.TgZ(15,"a",101),e._uU(16,"Abrir voucher"),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&r){const t=e.oxw(2);e.xp6(7),e.hij("Seu pedido #",t.numberOrder," foi realizado com sucesso e o pagamento foi "),e.xp6(8),e.Q6J("href","https://voucher.ingressosa.com/voucher?id1="+t.orderId,e.LSH)}}function ce(r,d){if(1&r&&(e.YNc(0,oe,12,3,"div",2),e.YNc(1,ne,12,3,"div",2),e.YNc(2,se,13,3,"div",2),e.YNc(3,de,17,2,"div",2)),2&r){const t=e.oxw();e.Q6J("ngIf",1==t.pixPaymentSent&&0==t.paymentSuccess),e.xp6(1),e.Q6J("ngIf",1==t.picPayPaymentSent&&0==t.paymentSuccess),e.xp6(1),e.Q6J("ngIf",0==t.paymentSuccess&&1==t.paymentWaitingApproval),e.xp6(1),e.Q6J("ngIf",1==t.paymentSuccess)}}function le(r,d){1&r&&(e.ynx(0),e.TgZ(1,"noscript"),e._UZ(2,"img",102),e.qZA(),e.BQk())}let T=(()=>{class r{constructor(t,i,a,o,n,c,l,u,p){this.orderService=t,this.router=i,this.activatedRoute=a,this.formBuilder=o,this.alertService=n,this.authService=c,this.eventService=l,this.formHelper=u,this.mapV2Service=p,this.allTickets=[],this.ticketsWithSeats=[],this.public_key=A.N.keyMercadoPago,this.clientId="",this.unsubscribe$=new P.x,this.loading=!1,this.senderHash="",this.selectedCard="",this.selectedPaymentMethodId="",this.ticketOrderSubmit=[],this.mercadoPago=null,this.withFees=!1,this.cardBin="",this.installments=[],this.eventInstallment=1,this.totalAmount=0,this.totalFee=0,this.totalCardFee=0,this.totalSimulatedAmount=0,this.feePerTicket=0,this.totalTicketsFee=0,this.loadingCreditCardForm=!1,this.hasCreditCard=!1,this.paymentSent=!1,this.paymentSuccess=!1,this.paymentWaitingApproval=!1,this.orderForLoadId=null,this.comissionerName="",this.preOrderId=void 0,this.paymentInChange=void 0,this.eventId="",this.fengIntegration=!1,this.disabledAllButNotCard=!1,this.pixPaymentSent=!1,this.picPayPaymentSent=!1,this.thisClass=this}ngOnInit(){0==this.authService.isLoggednIn()&&this.router.navigateByUrl("/"),this.fengIntegration=null!=this.orderService.getOrderEvent()&&null!=this.orderService.getOrderEvent().fengIntegration&&this.orderService.getOrderEvent().fengIntegration;let t=this.activatedRoute.snapshot.queryParams.rfr;if(null!=t&&""!==t?(this.orderForLoadId=t,this.loadPreOrder()):(this.loadOrder(),this.eventLink=this.order.event.slugs&&this.order.event.slugs.length>0?"../"+this.order.event.slugs[0].slug:"/event/"+this.order.event.id),this.getEventInformation(),this.applyFees(0),this.updateReserveMapV2(),null==this.mercadoPago&&(this.mercadoPago=new MercadoPago(this.public_key)),this.creditCardForm=this.formBuilder.group({cardNumber:["",[s.kI.required,s.kI.minLength(13)]],cardholderName:["",s.kI.required],cardholderEmail:[this.authService.getCustomer().email,s.kI.email],expirationDate:["",[s.kI.required,s.kI.minLength(4)]],securityCode:["",[s.kI.required,s.kI.minLength(3)]],identificationNumber:["",[s.kI.required,s.kI.minLength(11)]],identificationType:["CPF",s.kI.required],email:[this.authService.getCustomer().email,[s.kI.required,s.kI.email]],issuer:["",s.kI.required],installments:[1,s.kI.required],paymentMethodId:["",s.kI.required]},{validators:[this.formHelper.testCpf]}),this.orderService.currentOrder.subscribe(i=>{"e6a772ac-5a35-4724-988d-ad2a648b7ec1"==i.event.id&&(this.ticketTags=i.event.ticketTags,this.eventId=i.event.id)}),null!=window&&"1d1519c9-0997-4de7-a5d8-b6674a90c512"==this.eventId){let o=function(n,c){a.push(arguments)};document.createElement("script").setAttribute("src","https://www.googletagmanager.com/gtag/js?id=AW-11124555266");let a=window.dataLayer||[];o("js",new Date),o("config","AW-11124555266")}}ngAfterViewInit(){this.paymentMethods.forEach(t=>{"MercadoPagoCreditCard"==t.gateway&&(this.hasCreditCard=!0)})}ngOnDestroy(){if(this.unsubscribe$.next(null),this.unsubscribe$.complete(),null!=this.orderForLoadId&&""!==this.orderForLoadId&&this.orderService.removeAllTickets(),this.orderService.removeAllTickets(),this.subscription&&this.subscription.unsubscribe(),null!=window&&"1d1519c9-0997-4de7-a5d8-b6674a90c512"==this.order.event.id)for(let t=0;t<document.getElementsByTagName("script").length;t++)null!=document.getElementsByTagName("script")[t].src.split("id=")[1]&&"AW-11124555266"==document.getElementsByTagName("script")[t].src.split("id=")[1].split("&")[0]&&(document.getElementsByTagName("script")[t].src="")}selectPaymentMethod(t,i,a){this.paymentMethod=t,this.paymentMethodName=i,this.selectedPaymentMethodId=a,this.paymentMethods.forEach(n=>{a==n.id&&(n.public_key&&(this.public_key=n.public_key),n.client_id&&(this.clientId=n.client_id))}),this.mercadoPago=new MercadoPago(this.public_key),this.applyFees(0),this.gateway=t,this.applyFees(1),this.withFees=!0,this.eventInstallment=1,this.creditCardForm.get("installments").setValue(1)}getCardInformation(){let t=this.creditCardForm.controls.cardNumber.value,i=this.creditCardForm.controls.cardNumber;if("e6a772ac-5a35-4724-988d-ad2a648b7ec1"==this.order.event.id&&null!=this.order.event.ticketTags&&""!==this.order.event.ticketTags&&t.length>=6&&t.substring(0,6)!==this.order.event.ticketTags)return this.alertService.toast({icon:"error",title:"Erro",text:"C\xf3digo bin \xe9 diferente do cart\xe3o digitado"}),void i.setValue("");"54cc662e-c31d-4737-94e0-48b1dd3024b1"==this.order.event.id&&this.order.tickets.forEach((a,o)=>{if("9368d0a9-28b4-401a-bb3f-7dbabf036e9b"==a.id&&t.length>=6&&t.substring(0,6)!==this.order.event.ticketTags)return this.alertService.toast({icon:"error",title:"Erro",text:"C\xf3digo bin \xe9 diferente do cart\xe3o digitado"}),void i.setValue("")}),t.length>=6&&this.cardBin!=t.substring(0,6)&&(this.cardBin=t.substring(0,6),this.mercadoPago.getPaymentMethods({bin:t}).then(a=>{this.selectedCard=a.results[0].id,this.creditCardForm.controls.paymentMethodId.setValue(a.results[0].id),this.creditCardForm.controls.issuer.setValue(a.results[0].issuer.name),this.getInstallments(t)}).catch(a=>{this.alertService.toast({icon:"error",title:"Erro ao verificar seu cart\xe3o",text:"Houve um erro ao verificar o seu cart\xe3o. Verifique se o n\xfamero do seu cart\xe3o est\xe1 correto"})}))}getInstallments(t){for(let i=1;i<13;i++){let a=this.applyFees(i,!0);a&&this.mercadoPago.getInstallments({bin:t,amount:a.toFixed(2)}).then(o=>{let c=o[0].payer_costs.find(l=>l.installments==i);c&&(this.installments[this.installments.length]=c,this.installments=this.installments.sort((l,u)=>l.installments>u.installments?1:-1))}).catch(o=>{this.alertService.toast({icon:"error",title:"Erro ao obter parcelas",text:"Houve um erro ao obter as parcelas para o cart\xe3o informado. Verifique se o n\xfamero do seu cart\xe3o est\xe1 correto"})})}}getSelectedInstallments(t){this.eventInstallment=this.creditCardForm.controls.installments.value;let i=this.installments.find(a=>a.installments==this.eventInstallment);this.totalAmount=i.total_amount,this.totalFee=this.totalAmount-this.amount(void 0,!1),this.totalCardFee=this.totalAmount-this.applyFees(this.eventInstallment,!0)}generateCardToken(){const i=Object.assign({},this.creditCardForm.value);let a=i.expirationDate;return i.cardExpirationMonth=a.substring(0,2),i.cardExpirationYear=a.substring(2,7),i.cardExpiration=i.cardExpirationMonth+"/"+i.cardExpirationYear,i.docNumber=i.identificationNumber,i.docType=i.identificationType,i.public_key=this.public_key,delete i.issuer,delete i.paymentMethodId,delete i.cardholderEmail,delete i.email,delete i.identificationNumber,delete i.identificationType,delete i.expirationDate,this.mercadoPago.createCardToken(i)}creditCardPayment(){var t=this;return(0,g.Z)(function*(){if(1==t.creditCardForm.invalid)return t.showCreditCardFormErrorMessages(),!1;let i;return yield t.generateCardToken().then(a=>(i=a.id,null!=i?(t.params.paymentMethods[0].token=i,t.params.paymentMethods[0].payment_method_id_mp=t.creditCardForm.controls.paymentMethodId.value,t.params.paymentMethods[0].mpDeviceSessionId=t.mpSessionId.nativeElement.defaultValue?t.mpSessionId.nativeElement.defaultValue:null,!0):(t.alertService.toast({icon:"error",title:"Erro ao verificar seu cart\xe3o",text:"Houve um erro ao verificar o seu cart\xe3o. Verifique dados como n\xfamero, CCV e data de expira\xe7\xe3o"}),!1))).catch(a=>(t.alertService.toast({icon:"error",title:"Erro ao verificar seu cart\xe3o",text:"Houve um erro ao verificar o seu cart\xe3o. Verifique dados como n\xfamero, CCV e data de expira\xe7\xe3o"}),!1))})()}showCreditCardFormErrorMessages(){this.creditCardForm.controls.identificationNumber.errors&&this.creditCardForm.controls.identificationNumber.errors.invalidCpf&&this.alertService.toast({icon:"error",title:"CPF",text:"CPF \xe9 inv\xe1lido"}),this.creditCardForm.controls.identificationNumber.errors&&this.creditCardForm.controls.identificationNumber.errors.minlength&&this.alertService.toast({icon:"error",title:"CPF",text:"N\xfamero do CPF incompleto"}),this.creditCardForm.controls.identificationNumber.errors&&this.creditCardForm.controls.identificationNumber.errors.required&&this.alertService.toast({icon:"error",title:"CPF",text:"CPF \xe9 obrigat\xf3rio"}),this.creditCardForm.controls.cardholderName.errors&&this.creditCardForm.controls.cardholderName.errors.required&&this.alertService.toast({icon:"error",title:"Nome do titular",text:"Nome do portador do cart\xe3o \xe9 obrigat\xf3rio"}),this.creditCardForm.controls.securityCode.errors&&this.creditCardForm.controls.securityCode.errors.minlength&&this.alertService.toast({icon:"error",title:"CCV",text:"CCV tem que ter no m\xednimo 3 n\xfameros"}),this.creditCardForm.controls.securityCode.errors&&this.creditCardForm.controls.securityCode.errors.required&&this.alertService.toast({icon:"error",title:"CCV",text:"CCV \xe9 obrigat\xf3rio"}),this.creditCardForm.controls.expirationDate.errors&&this.creditCardForm.controls.expirationDate.errors.minlength&&this.alertService.toast({icon:"error",title:"Data de expira\xe7\xe3o",text:"Data de expira\xe7\xe3o tem que ter m\xeas e ano"}),this.creditCardForm.controls.expirationDate.errors&&this.creditCardForm.controls.expirationDate.errors.required&&this.alertService.toast({icon:"error",title:"Data de expira\xe7\xe3o",text:"Insira uma data de expira\xe7\xe3o"}),this.creditCardForm.controls.cardNumber.errors&&this.creditCardForm.controls.cardNumber.errors.required&&this.alertService.toast({icon:"error",title:"N\xfamero do cart\xe3o necess\xe1rio",text:"N\xfamero do cart\xe3o \xe9 necess\xe1rio"}),this.creditCardForm.controls.cardNumber.errors&&this.creditCardForm.controls.cardNumber.errors.minlength&&this.alertService.toast({icon:"error",title:"N\xfamero do cart\xe3o incompleto",text:"N\xfamero do cart\xe3o tem que ter no m\xednimo 13 n\xfameros"})}copyQrCode(){this.qrCodeInput.nativeElement.select(),document.execCommand("copy")}fee(){return this.orderService.fee()}amount(t,i=!0){return this.orderService.amount(t,i)}countTickets(t,i){return this.orderService.countTickets(t,i)}getEventInformation(){this.orderService.currentOrder.pipe((0,v.R)(this.unsubscribe$)).subscribe(t=>{var i,a;this.eventId=null!==(a=null===(i=t.event)||void 0===i?void 0:i.id)&&void 0!==a?a:"",this.paymentMethods=t.event.paymentMethods})}applyFees(t,i=!1){let a;return this.paymentMethods.forEach(o=>{o.id==this.selectedPaymentMethodId&&o.options.length>0&&o.options.forEach(n=>{n.installments==t&&(a=n.fees[0])})}),this.totalSimulatedAmount=0,this.allTickets.forEach((o,n)=>{for(const c in o.fees)if(o.fees.hasOwnProperty(c)){const l=o.fees[c];if(c==a){let u=Math.ceil(o.price*l)/100,p=Math.ceil(o.price*l)/100*this.countTickets(o.id,o.placeName);i?this.totalSimulatedAmount+=p:(this.totalTicketsFee=p,this.totalAmount+=p,this.totalFee+=p),this.allTickets[n].feePerTicket=u}else t>0||(this.totalAmount=this.amount(),this.totalFee=this.totalAmount-this.amount(void 0,!1),this.allTickets[n].feePerTicket=0)}}),i?this.totalSimulatedAmount+this.amount():this.totalAmount+this.amount()}loadPreOrder(){let t={};this.orderService.removeAllTickets(),null!==this.orderForLoadId&&this.orderService.getOrderByRfr([this.orderForLoadId],!0).pipe((0,_.K)(i=>(this.orderService.removeAllTickets(),this.alertService.toast({icon:"error",title:"Erro ao buscar pedido"}),(0,C.of)(i)))).subscribe(i=>{var a,o;if(this.order=i[0],this.comissionerName=this.order.customer.name,this.orderId=this.order.order.id,this.paymentInChange=null===(o=null===(a=this.order)||void 0===a?void 0:a.order)||void 0===o?void 0:o.paymentInChange,t.eventId=this.activatedRoute.snapshot.paramMap.get("eventId"),this.order.tickets&&this.order.tickets.length){let n=this.order.tickets.find(c=>c.comissionerId);null!=(null==n?void 0:n.comissionerId)&&(t.comissionerId=null==n?void 0:n.comissionerId),t.forPaymentChange=!0}this.eventService.list2site(t).subscribe(n=>{this.orderService.setEvent(n),this.eventName=n.name,this.order.tickets.forEach(c=>{var l;null===(l=null==n?void 0:n.tickets)||void 0===l||l.forEach((u,p)=>{c.ticketId==u.id&&(u.qty=c.quantity,u.comissionerId=c.comissionerId,this.orderService.addTicket(u,u.isSeatsIo))})}),this.orderService.currentOrder.pipe((0,v.R)(this.unsubscribe$)).subscribe(c=>{this.order=c,this.tickets=this.order.tickets.filter((l,u,p)=>u===p.findIndex(x=>x.id===l.id)&&null==l.placeName),this.ticketsWithSeats=this.order.tickets.filter((l,u,p)=>u===p.findIndex(x=>x.placeName===l.placeName)&&void 0!==l.placeName),this.tickets.forEach((l,u)=>{null!=l.orderMapReserveCode&&(this.orderMapReserveCode=l.orderMapReserveCode)}),this.allTickets=this.allTickets.concat(this.tickets,this.ticketsWithSeats).filter(l=>void 0!==l)})}),this.checkOrder()})}loadOrder(){this.orderService.currentOrder.pipe((0,v.R)(this.unsubscribe$)).subscribe(t=>{if(null!=t)if(t.tickets.length>=1){if(this.order=t,this.eventName=t.event.name,this.tickets=this.order.tickets.filter((a,o,n)=>o===n.findIndex(c=>c.id===a.id)&&null==a.placeName),this.ticketsWithSeats=this.order.tickets.filter((a,o,n)=>o===n.findIndex(c=>c.placeName===a.placeName)&&void 0!==a.placeName),this.order.tickets.filter((a,o,n)=>o===n.findIndex(c=>c.placeName===a.placeName)&&void 0!==a.placeName),this.order.tickets.forEach((a,o)=>{null!=a.orderMapReserveCode&&(this.orderMapReserveCode=a.orderMapReserveCode)}),null!=window&&"1d1519c9-0997-4de7-a5d8-b6674a90c512"==this.order.event.id){let n=function(c,l){o.push(arguments)};document.createElement("script").setAttribute("src","https://www.googletagmanager.com/gtag/js?id=AW-11124555266");let o=window.dataLayer||[];n("js",new Date),n("config","AW-11124555266")}"54cc662e-c31d-4737-94e0-48b1dd3024b1"==this.order.event.id&&this.order.tickets.forEach((a,o)=>{"9368d0a9-28b4-401a-bb3f-7dbabf036e9b"==a.id&&(this.disabledAllButNotCard=!0)}),this.allTickets=this.allTickets.concat(this.tickets,this.ticketsWithSeats).filter(a=>void 0!==a),this.checkOrder()}else this.router.navigateByUrl("/");else this.router.navigateByUrl("/")})}createOrderStructure(){let t;t=this.applyFees(this.eventInstallment,!0),this.ticketOrderSubmit=[],this.allTickets.forEach((i,a)=>{for(let o=0;o<this.countTickets(i.id,i.placeName);o++){let n={};"f66f2e5c-58a0-4531-b3ef-035e3b5bb7af"==i.id?null!=this.order.additionalCustomer&&(n={id:this.order.additionalCustomer[o].id,name:this.order.additionalCustomer[o].name,doc:this.order.additionalCustomer[o].cpf,email:this.order.additionalCustomer[o].email,phones:[this.order.additionalCustomer[o].phone],loading:!1,additionalData:{model:this.order.additionalCustomer[o].additionalInformation.model,yearModel:this.order.additionalCustomer[o].additionalInformation.yearModel,version:this.order.additionalCustomer[o].additionalInformation.version,plate:this.order.additionalCustomer[o].additionalInformation.plate,sizeShirt:this.order.additionalCustomer[o].additionalInformation.sizeShirt,question:this.order.additionalCustomer[o].additionalInformation.question}}):n={id:this.authService.getCustomer().id,name:this.authService.getCustomer().name,doc:this.authService.getCustomer().doc,email:this.authService.getCustomer().email,phones:[null!=this.authService.getCustomer().phone&&null!=this.authService.getCustomer().phone[0]?this.authService.getCustomer().phone[0]:"21 9999-9999"],loading:!1},this.ticketOrderSubmit[this.ticketOrderSubmit.length]={ticketName:i.name,lotName:i.batch,ticketDateId:i.ticketDateId,lotId:i.lotId,placeName:i.placeName,placeId:i.placeId,placeHoldToken:i.placeHoldToken,quantity:i.qty,unitPrice:parseFloat((i.price+i.fee+(i.feePerTicket?i.feePerTicket:0)).toFixed(2)),unitPriceWithoutFee:i.price,customer:n,customerRequired:null,comissionerId:i.comissionerId,mapv2Id:i.mapv2Id,mapv2Row:i.mapv2Row,mapv2Number:i.mapv2Number}}}),this.params={order:{id:this.orderId,amount:t,ticketTags:this.orderService.getOrderEvent().ticketTags,orderMapReserveCode:this.orderMapReserveCode,paymentInChange:this.paymentInChange},tickets:this.ticketOrderSubmit,paymentMethods:[{amount:this.applyFees(this.eventInstallment,!0),installments:this.eventInstallment,paymentMethodId:this.selectedPaymentMethodId}],customer:{id:this.authService.getCustomer().id,name:this.authService.getCustomer().name,doc:this.authService.getCustomer().doc,email:this.authService.getCustomer().email,phones:[null!=this.authService.getCustomer().phone&&null!=this.authService.getCustomer().phone[0]?this.authService.getCustomer().phone[0]:"21 9999-9999"]}}}startOrder(){var t=this;return(0,g.Z)(function*(){var i;if(t.orderService.existsBlacklist())return t.alertService.toast({icon:"error",title:"Blacklist",text:`CPF bloqueado para adquirir o ingresso. ${t.orderService.ticketNameBlacklist()}`});t.loading=!0,yield t.createOrderStructure();let a=!0;if(t.paymentMethod&&-1!=t.paymentMethod.indexOf("MalgaCreditCard"))try{t.params.paymentMethods=[yield null===(i=t.gatewayClass)||void 0===i?void 0:i.submit()]}catch(o){console.log(o),t.loading=!1,a=!1}else t.paymentMethod&&-1!=t.paymentMethod.indexOf("Card")&&(a=yield t.creditCardPayment());if(0==t.params.order.amount&&(t.params.paymentMethods=[]),a){try{yield t.sendOrder()}catch(o){}t.mapV2Service.removeCart()}})()}sendOrder(){var t=this;return(0,g.Z)(function*(){t.orderService.sendPayment(t.params).pipe((0,_.K)(i=>(t.alertService.toast({icon:"error",title:"Erro",text:i.error.errors[0].msg}),t.ticketOrderSubmit.length=0,t.loading=!1,(0,C.of)(i)))).subscribe(i=>{var a,o,n,c,l,u;if(null==i.error)if(null!=(null===(a=t.order.event)||void 0===a?void 0:a.fbPixel)&&""!==(null===(o=t.order.event)||void 0===o?void 0:o.fbPixel)&&t.loadScript(null===(c=null===(n=t.order)||void 0===n?void 0:n.event)||void 0===c?void 0:c.fbPixel),"aabf03d4-1064-42fb-ab42-89dcc1b79adb"==(null===(l=t.order.event)||void 0===l?void 0:l.id)&&t.loadScript("1252794108792421"),t.paymentMethod)if("MercadoPagoCreditCard"==t.paymentMethod)t.getCardPaymentRes(i);else if("MercadoPagoPix"==t.paymentMethod)t.getMercadoPagoPixPaymentRes(i);else if("PagSeguroPix"==t.paymentMethod)t.getPagSeguroPixPaymentRes(i);else if("PicPay"==t.paymentMethod)t.getPicPayPaymentRes(i);else if("MalgaPix"==t.paymentMethod)t.getMalgaPixResponse(i);else try{null===(u=t.gatewayClass)||void 0===u||u.processResponse(i)}catch(p){console.log(p)}else t.getNoPaymentRes(i);t.loading=!1})})()}getCardPaymentRes(t){"Invalid security_code_length"==t.payments[0].return2User[0]&&this.alertService.toast({icon:"error",title:"Erro",text:"CCV inv\xe1lido"}),"Invalid credentials"==t.payments[0].return2User[0]&&this.alertService.toast({icon:"error",title:"Erro",text:"Dados do cart\xe3o s\xe3o inv\xe1lidos"}),"Invalid card_number_validation"==t.payments[0].return2User[0]&&this.alertService.toast({icon:"error",title:"Erro",text:"N\xfamero do cart\xe3o inv\xe1lido"}),0==t.payments[0].success&&t.payments[0].return2User.length<1?this.alertService.toast({icon:"error",title:"Erro",text:"N\xe3o foi poss\xedvel realizar o pagamento. Cheque todos os campos e dados do seu cart\xe3o."}):("Refused"==t.payments[0].return2User[0].status&&(this.alertService.toast({icon:"error",title:"Pagamento falhou",text:"Pagamento recusado, verifique as informa\xe7\xf5es do cart\xe3o e do comprador."}),this.paymentSent=!0,this.paymentSuccess=!1,this.paymentWaitingApproval=!1),"Waiting"==t.payments[0].return2User[0].status&&(this.alertService.toast({icon:"warning",title:"Aguardando confirma\xe7\xe3o",text:"Pagamento aguardando aprova\xe7\xe3o"}),this.paymentSent=!0,this.paymentSuccess=!1,this.numberOrder=t.order.autoincrement,this.paymentWaitingType="aguardando confirma\xe7\xe3o",this.paymentWaitingApproval=!0,this.checkPayment(t.order.id)),"Analysis"==t.payments[0].return2User[0].status&&(this.alertService.toast({icon:"warning",title:"Pagamento em an\xe1lise",text:"Pagamento est\xe1 em an\xe1lise"}),this.paymentSent=!0,this.numberOrder=t.order.autoincrement,this.paymentSuccess=!1,this.paymentWaitingType="em an\xe1lise",this.paymentWaitingApproval=!0,this.checkPayment(t.order.id)),"Approved"==t.payments[0].return2User[0].status&&(this.alertService.toast({icon:"success",title:"Sucesso",text:"Pagamento aprovado"}),this.numberOrder=t.order.autoincrement,this.orderId=t.order.id,this.paymentSent=!0,this.paymentSuccess=!0,this.orderService.removeAllTickets()))}getMercadoPagoPixPaymentRes(t){1==t.payments[0].success?(this.paymentSent=!0,this.pixPaymentSent=!0,this.picPayPaymentSent=!1,this.checkPayment(t.order.id),this.numberOrder=t.order.autoincrement,this.qrCode=t.payments[0].gatewayTransaction.additionalData.qrCode,this.qrCodeBase64="data:image/jpeg;base64,"+t.payments[0].gatewayTransaction.additionalData.qrCodeBase64,this.expirationDate=t.payments[0].gatewayTransaction.expiration):this.alertService.toast({icon:"error",title:"Ocorreu um erro",text:t.payments[0].return2User[0]})}getMalgaPixResponse(t){1==t.payments[0].success?(this.paymentSent=!0,this.pixPaymentSent=!0,this.picPayPaymentSent=!1,this.checkPayment(t.order.id),this.numberOrder=t.order.autoincrement,this.qrCode=t.payments[0].gatewayTransaction.additionalData.qrCode,this.qrCodeBase64="data:image/jpeg;base64,"+t.payments[0].gatewayTransaction.additionalData.qrCodeBase64,this.expirationDate=t.payments[0].gatewayTransaction.expiration):this.alertService.toast({icon:"error",title:"Ocorreu um erro",text:t.payments[0].return2User[0]})}getPagSeguroPixPaymentRes(t){1==t.payments[0].success?(this.paymentSent=!0,this.pixPaymentSent=!0,this.picPayPaymentSent=!1,this.checkPayment(t.order.id),this.numberOrder=t.order.autoincrement,this.qrCode=t.payments[0].gatewayTransaction.additionalData.qrCode,this.qrCodeBase64=t.payments[0].gatewayTransaction.additionalData.qrCodeUrl):this.alertService.toast({icon:"error",title:"Ocorreu um erro",text:t.payments[0].return2User[0]})}getPicPayPaymentRes(t){1==t.payments[0].success?(this.paymentSent=!0,this.picPayPaymentSent=!0,this.pixPaymentSent=!1,this.checkPayment(t.order.id),this.numberOrder=t.order.autoincrement,this.qrCode=t.payments[0].gatewayTransaction.additionalData.qrCode,this.qrCodeBase64=t.payments[0].gatewayTransaction.additionalData.qrCodeBase64,this.expirationDate=t.gatewayTransaction.expiration):this.alertService.toast({icon:"error",title:"Ocorreu um erro",text:t.payments[0].return2User[0]})}getNoPaymentRes(t){"Approved"==t.order.status?(this.paymentSuccess=!0,this.numberOrder=t.order.autoincrement,this.orderId=t.order.id,this.subscription.unsubscribe(),this.orderService.removeAllTickets()):this.alertService.toast({icon:"error",title:"Ocorreu um erro",text:"Ocorreu um erro ao gerar seu pedido."})}checkPayment(t){this.subscription=(0,M.F)(5e3).subscribe(()=>{this.orderService.getOrderById(t).pipe((0,_.K)(i=>(this.alertService.toast({icon:"error",title:"Erro",text:i.error.errors[0].msg}),this.ticketOrderSubmit.length=0,(0,C.of)(i)))).subscribe(i=>{"Approved"==i[0].status&&(this.paymentSuccess=!0,this.pixPaymentSent=!1,this.picPayPaymentSent=!1,this.numberOrder=i.order.autoincrement,this.orderId=i[0].id,this.subscription.unsubscribe(),this.orderService.removeAllTickets()),"Refused"==i[0].status&&(this.paymentSuccess=!1,this.alertService.toast({icon:"error",title:"Pagamento recusado",text:"Seu pagamento Pix foi recusado. Verifique se o seu pedido j\xe1 expirou pois \xe9 v\xe1lido por 30 minutos."}),this.subscription.unsubscribe()),"Cancelled"==i[0].status&&(this.paymentSuccess=!1,this.alertService.toast({icon:"error",title:"Pagamento cancelado",text:"Seu pagamento Pix foi cancelado"}),this.subscription.unsubscribe())})})}checkOrder(){if(void 0!==this.order){if(0==this.order.tickets.length&&0==this.paymentSuccess&&this.router.navigate(["/"]),!this.order.customer&&0==this.paymentSuccess)return void this.router.navigateByUrl("/auth/login?redirect=checkout")}else this.router.navigate(["/"])}updateReserveMapV2(){var t=this;return(0,g.Z)(function*(){try{const i=t.mapV2Service.getCart();if(i){const a=i.places.map(o=>({row:o.row,number:o.number}));yield t.mapV2Service.updateReserve(i.mapId,a)}}catch(i){}})()}loadScript(t){var i,a,o,c,l,u;i=window,a=document,o="script",c=null,l=null,u=null,null==i.fbq&&(c=i.fbq=function(){null!=c.callMethod?c.callMethod.apply(c,arguments):c.queue.push(arguments)},null==i._fbq&&(i._fbq=c,c.push=c,c.loaded=!0,c.version="2.0",c.queue=[],(l=a.createElement(o)).async=!0,l.src="https://connect.facebook.net/en_US/fbevents.js",(u=a.getElementsByTagName(o)[0]).parentNode.insertBefore(l,u))),window.fbq.disablePushState=!0,window.fbq("init",t),window.fbq("track","PageView"),window.fbq("track","ViewContent"),window.fbq("track","Purchase",{currency:"BRL",value:this.applyFees(this.eventInstallment,!0)})}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(q.p),e.Y36(f.F0),e.Y36(f.gz),e.Y36(s.qu),e.Y36(Z.c),e.Y36(S.e),e.Y36(I.P),e.Y36(k.w),e.Y36(N.a))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-payment-method"]],viewQuery:function(t,i){if(1&t&&(e.Gf(w,5),e.Gf(F,5)),2&t){let a;e.iGM(a=e.CRH())&&(i.mpSessionId=a.first),e.iGM(a=e.CRH())&&(i.qrCodeInput=a.first)}},decls:4,vars:3,consts:[[4,"ngIf","ngIfElse"],["showCheckoutLastStep",""],[4,"ngIf"],[1,"container-fluid","mt-5","mb-5"],[1,"row"],["class","col-md-6",4,"ngIf"],[1,"col-md-6","mt-md-0","ms-auto","mt-5"],[1,"mb-1"],[1,"mt-3","mb-3","fw-bold","fs-5"],[1,"card"],[1,"table-responsive"],[1,"table"],["scope","col",1,"ps-3"],["scope","col",1,"text-center"],["scope","col",1,"text-center","pe-3"],[4,"ngFor","ngForOf"],["colspan","3",1,"text-end","border-0","pt-3"],[1,"fs-6","m-0"],[1,"text-grad","fw-bold","fs-3","m-0"],[1,"fs-6","text-muted","m-0"],["class","mt-3 fs-6 text-muted",4,"ngIf"],[1,"d-flex","justify-content-center","p-4","animate__animated","animate__fadeIn"],[1,"col-md-6"],[1,"card","border-0"],["id","accordionExample",1,"accordion"],["showPix",""],[1,"accordion-item"],["id","creditcard",1,"accordion-header"],["type","button","data-bs-toggle","collapse","data-bs-target","#collapseCreditCard","aria-expanded","false","aria-controls","collapseCreditCard",1,"btn","btn-light","rounded-0","p-3","w-100","collapsed",3,"click"],[1,"d-flex","align-items-center","justify-content-between"],[1,"accordion-title"],["src","../../../../assets/images/credit-card.png","width","40"],["id","collapseCreditCard","aria-labelledby","creditcard","data-bs-parent","#accordionExample",1,"accordion-collapse","collapse"],["id","form-checkout",3,"formGroup"],[1,"accordion-body","payment-card-body"],[1,"col-sm-12","mb-3"],[1,"font-weight-normal","text-muted","card-text"],[1,"input"],["showCardPicture",""],["formControlName","cardNumber","mask","0000 0000 0000 0000 || 0000 000000 0000 || 0000 000000 00000","id","form-checkout__cardNumber",1,"form-control","ps-4",3,"keyup","input"],[1,"col-sm-7","mb-3"],[1,"fa","fa-calendar"],["formControlName","expirationDate","mask","00/0000 || 00/00","maxlength","7","id","form-checkout__expirationDate",1,"form-control","ps-3"],[1,"col-sm-5","mb-3"],[1,"fa","fa-lock"],["formControlName","securityCode","minlength","3","mask","0000","maxlength","4","id","form-checkout__securityCode",1,"form-control","ps-3"],[1,"fa","fa-user"],["type","text","formControlName","cardholderName","id","form-checkout__cardholderName"],[1,"fa","fa-id-badge"],["type","text","formControlName","identificationNumber","mask","000.000.000-00","id","form-checkout__identificationNumber"],[1,"fa","fa-timer"],["formControlName","installments","id","form-checkout__installments",3,"change"],["value","",4,"ngIf","ngIfElse"],["showInstallments",""],["type","hidden","formControlName","paymentMethodId"],["type","hidden","formControlName","cardholderEmail"],["type","hidden","formControlName","issuer"],[1,"text-muted","certificate-text"],[1,"fa","fa-lock","me-1"],["type","hidden","id","deviceId"],["mpSessionId",""],[1,"fa","fa-credit-card"],[1,"cardBank","me-5"],["width","33px",3,"src"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[3,"baseClass","paymentMethod"],["class","accordion-item",4,"ngIf"],["id","",1,"accordion-header"],["type","button","data-bs-toggle","collapse","aria-expanded","false","aria-controls","collapsePi",1,"btn","btn-light","rounded-0","p-3","w-100","collapsed",3,"click"],["class","accordion-collapse collapse","aria-labelledby","pix","data-bs-parent","#accordionExample",3,"id",4,"ngIf"],["src","../../../../assets/images/pix.png","width","40"],["src","../../../../assets/images/picpay.png","width","40"],["aria-labelledby","pix","data-bs-parent","#accordionExample",1,"accordion-collapse","collapse",3,"id"],[1,"accordion-body","payment-card-body","text-center"],[1,"align-middle","ps-3"],[1,"text-grad","fw-bold","m-0"],["class","m-0",4,"ngIf"],[1,"m-0"],[1,"text-center","align-middle"],[1,"text-center","align-middle","pe-3"],[1,"mt-3","fs-6","text-muted"],[1,"btn","btn-grad","btn-lg","fw-bold","text-uppercase",3,"disabled","click"],["showText",""],["spinnerType","grow","spinnerWidth","33"],[1,"d-flex","mt-5","justify-content-center","w-50","mx-auto"],[1,"d-flex","mt-5","justify-content-center"],["width","300px",3,"src"],[1,"mt-5","d-flex","mx-auto","w-75","justify-content-center"],["type","text","readonly","true",1,"form-control",3,"ngModel"],["qrCodeInput",""],[1,"mt-2","d-flex","justify-content-center"],[1,"btn","btn-grad","btn-md","mt-3",3,"click"],[1,"w-100","col-lg-12","m-auto","text-center"],[1,"d-flex","justify-content-center","mb-3","mt-5"],[1,"fs-3",2,"color","green"],["col-lg-12",""],[1,"mt-5"],[1,"badge","bg-warning"],[1,"badge","bg-success"],["target","_blank",1,"btn","btn-grad","btn-md","mt-3",3,"href"],["height","1","width","1","src","https://www.facebook.com/tr?id=230087008909730&ev=PageView&noscript=1",2,"display","none"]],template:function(t,i){if(1&t&&(e.YNc(0,ae,42,18,"div",0),e.YNc(1,ce,4,4,"ng-template",null,1,e.W1O),e.YNc(3,le,3,0,"ng-container",2)),2&t){const a=e.MAs(2);e.Q6J("ngIf",0==i.paymentSent&&0==i.paymentSuccess)("ngIfElse",a),e.xp6(3),e.Q6J("ngIf","c3421010-fa33-403a-a06d-0792d676edf4"==i.eventId||"996b7e49-f5ed-4a94-9157-c2b0d8937481"==i.eventId)}},styles:[".form-control[_ngcontent-%COMP%]{height:50px;border:2px solid #eee;border-radius:5px;font-size:14px;width:100%}.form-control[_ngcontent-%COMP%]:focus{color:#495057;background-color:#fff;border-color:#039be5;outline:0;box-shadow:none}.input[_ngcontent-%COMP%]{position:relative}.input[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{position:absolute;top:13px;left:13px;color:#989898;font-size:23px}.input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{text-indent:25px}.accordion-title[_ngcontent-%COMP%]{font-size:1.25rem}.card-text[_ngcontent-%COMP%]{font-size:13px;margin-left:6px}.certificate-text[_ngcontent-%COMP%]{font-size:12px}.payment-card-body[_ngcontent-%COMP%]{flex:1 1 auto;padding:24px 1rem!important}.accordion-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:not(.collapsed){background-image:var(--background-linear-gradient);border:0;color:#fff;font-weight:600}#form-checkout[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-width:600px}.containerFieldsCheckout[_ngcontent-%COMP%]{height:50px;border:1px solid #767676;border-radius:2px;padding:1px 2px}#form-checkout[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{height:50px;width:100%}#form-checkout[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border:2px solid #eee;outline:none}#form-checkout[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{border:2px solid #eee;outline:none;background:white;border-radius:5px}.cardBank[_ngcontent-%COMP%]{top:9px!important}#form-checkout__cardNumber-container[_ngcontent-%COMP%]{padding-left:48px;border:2px solid #eee;border-radius:5px;width:100%}#cardNumber[_ngcontent-%COMP%]{font-size:14px!important}#form-checkout__expirationDate-container[_ngcontent-%COMP%]{padding-left:43px;border:2px solid #eee;border-radius:5px;font-size:14px;width:100%}#form-checkout__securityCode-container[_ngcontent-%COMP%]{padding-left:43px;border:2px solid #eee;border-radius:5px;width:100%}#form-checkout__cardholderName[_ngcontent-%COMP%], #form-checkout__identificationNumber[_ngcontent-%COMP%], #form-checkout__cardholderEmail[_ngcontent-%COMP%]{padding-left:15px;font-size:18px;border:2px solid #eee;border-radius:5px;width:100%}"]}),r})();const me=[{path:"",component:T}];let ue=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[[f.Bz.forChild(me)],f.Bz]}),r})();var pe=m(1268),y=m(5003),he=m(9962),ge=m(520);let fe=(()=>{class r{constructor(t){this.httpClient=t,this.apiUrl="https://api.malga.io/v1/",this.route_create_token="tokens"}setCredentials(t,i){this.header={"X-Client-ID":t,"X-Api-Key":i}}createCardToken(t){return this.httpClient.post(this.apiUrl+this.route_create_token,t,{headers:this.header}).toPromise().then(a=>a.tokenId).catch(a=>{throw console.log(a),new Error(a.error.error.message)})}}return r.\u0275fac=function(t){return new(t||r)(e.LFG(ge.eN))},r.\u0275prov=e.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();function ve(r,d){1&r&&(e.TgZ(0,"option",29),e._uU(1,"Aguardando cart\xe3o"),e.qZA())}function _e(r,d){if(1&r&&(e.TgZ(0,"option",31),e._uU(1),e.qZA()),2&r){const t=d.$implicit;e.s9C("value",t.installments),e.xp6(1),e.Oqu(t.recommended_message)}}function Ce(r,d){if(1&r&&e.YNc(0,_e,2,2,"option",30),2&r){const t=e.oxw();e.Q6J("ngForOf",t.installments)}}let ye=(()=>{class r{constructor(t,i,a){this.formBuilder=t,this.malgaService=i,this.alertService=a,this.installments=[]}ngOnInit(){this.creditCardForm=this.formBuilder.group({cardNumber:["",[s.kI.required,s.kI.minLength(13)]],cardholderName:["",s.kI.required],expirationDate:["",[s.kI.required,s.kI.minLength(6)]],securityCode:["",[s.kI.required,s.kI.minLength(3)]],installments:[1,s.kI.required]}),this.baseClass.gatewayClass=this}submit(){var t=this;return(0,g.Z)(function*(){if(!t.creditCardForm.valid)throw t.showValidationMessages(),"Invalid Card Parameters";return{amount:t.baseClass.totalAmount,token:yield t.createCardToken(),installments:t.creditCardForm.value.installments,paymentMethodId:t.paymentMethod.id}})()}processResponse(t){var i;if(0==t.payments[0].success){if(t.payments[0].return2User.length<1)return void this.alertService.toast({icon:"error",title:"Erro",text:"N\xe3o foi poss\xedvel realizar o pagamento. Cheque todos os campos e dados do seu cart\xe3o."});t.payments[0].return2User&&"string"==typeof(null===(i=t.payments[0])||void 0===i?void 0:i.return2User[0])&&this.alertService.toast({icon:"error",title:"Erro",text:t.payments[0].return2User})}"Refused"==t.payments[0].return2User[0].status?(this.alertService.toast({icon:"error",title:"Pagamento falhou",text:"Pagamento recusado, verifique as informa\xe7\xf5es do cart\xe3o e do comprador."}),this.baseClass.paymentSent=!0,this.baseClass.paymentSuccess=!1,this.baseClass.paymentWaitingApproval=!1):"Waiting"==t.payments[0].return2User[0].status?(this.alertService.toast({icon:"warning",title:"Aguardando confirma\xe7\xe3o",text:"Pagamento aguardando aprova\xe7\xe3o"}),this.baseClass.paymentSent=!0,this.baseClass.paymentSuccess=!1,this.baseClass.numberOrder=t.order.autoincrement,this.baseClass.paymentWaitingType="aguardando confirma\xe7\xe3o",this.baseClass.paymentWaitingApproval=!0,this.baseClass.checkPayment(t.order.id)):"Analysis"==t.payments[0].return2User[0].status?(this.alertService.toast({icon:"warning",title:"Pagamento em an\xe1lise",text:"Pagamento est\xe1 em an\xe1lise"}),this.baseClass.paymentSent=!0,this.baseClass.numberOrder=t.order.autoincrement,this.baseClass.paymentSuccess=!1,this.baseClass.paymentWaitingType="em an\xe1lise",this.baseClass.paymentWaitingApproval=!0,this.baseClass.checkPayment(t.order.id)):"Approved"==t.payments[0].return2User[0].status&&(this.alertService.toast({icon:"success",title:"Sucesso",text:"Pagamento aprovado"}),this.baseClass.numberOrder=t.order.autoincrement,this.baseClass.orderId=t.order.id,this.baseClass.paymentSent=!0,this.baseClass.paymentSuccess=!0)}setSelectedPaymentMethod(){this.baseClass.selectPaymentMethod(this.paymentMethod.gateway,this.paymentMethod.name,this.paymentMethod.id),this.loadInstallments()}validateCard(){this.creditCardForm.valid&&(this.baseClass.selectedCard="unknow")}loadInstallments(){for(let t=1;t<13;t++){let i=this.baseClass.applyFees(t,!0);i&&(i=Number((i/t).toFixed(2)),i=i.toLocaleString("pt-br",{minimumFractionDigits:2}),this.installments[this.installments.length]={installments:t,recommended_message:`${t} parcelas de R$ ${i}`})}}getSelectedInstallments(t){this.baseClass.eventInstallment=this.creditCardForm.controls.installments.value,this.baseClass.totalAmount=this.baseClass.applyFees(this.baseClass.eventInstallment,!0),this.baseClass.totalFee=this.baseClass.totalAmount-this.baseClass.amount(void 0,!1),this.baseClass.totalCardFee=this.baseClass.totalAmount-this.baseClass.applyFees(this.baseClass.eventInstallment,!0)}createCardToken(){var t=this;return(0,g.Z)(function*(){var i,a,o,n;t.malgaService.setCredentials(t.baseClass.clientId,t.baseClass.public_key);let c=null===(i=t.creditCardForm.get("expirationDate"))||void 0===i?void 0:i.value;try{return yield t.malgaService.createCardToken({cardHolderName:null===(a=t.creditCardForm.get("cardholderName"))||void 0===a?void 0:a.value,cardNumber:null===(o=t.creditCardForm.get("cardNumber"))||void 0===o?void 0:o.value,cardCvv:null===(n=t.creditCardForm.get("securityCode"))||void 0===n?void 0:n.value,cardExpirationDate:`${c.substring(0,2)}/${c.substring(2,7)}`})}catch(l){return void t.alertService.toast({icon:"error",title:"Valide os dados",text:l.message})}})()}showValidationMessages(){this.creditCardForm.controls.cardholderName.errors&&this.creditCardForm.controls.cardholderName.errors.required&&this.alertService.toast({icon:"error",title:"Nome do titular",text:"Nome do portador do cart\xe3o \xe9 obrigat\xf3rio"}),this.creditCardForm.controls.securityCode.errors&&this.creditCardForm.controls.securityCode.errors.minlength&&this.alertService.toast({icon:"error",title:"CCV",text:"CCV tem que ter no m\xednimo 3 n\xfameros"}),this.creditCardForm.controls.securityCode.errors&&this.creditCardForm.controls.securityCode.errors.required&&this.alertService.toast({icon:"error",title:"CCV",text:"CCV \xe9 obrigat\xf3rio"}),this.creditCardForm.controls.expirationDate.errors&&this.creditCardForm.controls.expirationDate.errors.minlength&&this.alertService.toast({icon:"error",title:"Data de expira\xe7\xe3o",text:"Data de expira\xe7\xe3o tem que ter m\xeas e ano"}),this.creditCardForm.controls.expirationDate.errors&&this.creditCardForm.controls.expirationDate.errors.required&&this.alertService.toast({icon:"error",title:"Data de expira\xe7\xe3o",text:"Insira uma data de expira\xe7\xe3o"}),this.creditCardForm.controls.cardNumber.errors&&this.creditCardForm.controls.cardNumber.errors.required&&this.alertService.toast({icon:"error",title:"N\xfamero do cart\xe3o necess\xe1rio",text:"N\xfamero do cart\xe3o \xe9 necess\xe1rio"}),this.creditCardForm.controls.cardNumber.errors&&this.creditCardForm.controls.cardNumber.errors.minlength&&this.alertService.toast({icon:"error",title:"N\xfamero do cart\xe3o incompleto",text:"N\xfamero do cart\xe3o tem que ter no m\xednimo 13 n\xfameros"})}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(s.qu),e.Y36(fe),e.Y36(Z.c))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-malga-credit-card"]],inputs:{baseClass:"baseClass",paymentMethod:"paymentMethod"},decls:48,vars:3,consts:[[1,"accordion-item"],["id","creditcard",1,"accordion-header"],["type","button","data-bs-toggle","collapse","data-bs-target","#collapseCreditCard","aria-expanded","false","aria-controls","collapseCreditCard",1,"btn","btn-light","rounded-0","p-3","w-100","collapsed",3,"click"],[1,"d-flex","align-items-center","justify-content-between"],[1,"accordion-title"],["src","../../../../assets/images/credit-card.png","width","40"],["id","collapseCreditCard","aria-labelledby","creditcard","data-bs-parent","#accordionExample",1,"accordion-collapse","collapse"],["id","form-checkout",3,"formGroup"],[1,"accordion-body","payment-card-body"],[1,"row"],[1,"col-sm-12","mb-3"],[1,"font-weight-normal","text-muted","card-text"],[1,"input"],[1,"fa","fa-credit-card"],["formControlName","cardNumber","placeholder","0000 0000 0000 0000","mask","0000 0000 0000 0000 || 0000 000000 0000 || 0000 000000 00000","id","form-checkout__cardNumber",1,"form-control","ps-4",3,"keyup"],[1,"col-sm-7","mb-3"],[1,"fa","fa-calendar"],["formControlName","expirationDate","mask","00/0000","placeholder","00/0000","maxlength","7","id","form-checkout__expirationDate",1,"form-control","ps-3",3,"keyup"],[1,"col-sm-5","mb-3"],[1,"fa","fa-lock"],["formControlName","securityCode","minlength","3","mask","0000","placeholder","000","maxlength","4","id","form-checkout__securityCode",1,"form-control","ps-3",3,"keyup"],[1,"fa","fa-user"],["type","text","formControlName","cardholderName","placeholder","Nome no cart\xe3o","id","form-checkout__cardholderName",1,"form-control","ps-3",3,"keyup"],[1,"fa","fa-timer"],["formControlName","installments","id","form-checkout__installments",3,"change"],["value","",4,"ngIf","ngIfElse"],["showInstallments",""],[1,"text-muted","certificate-text"],[1,"fa","fa-lock","me-1"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"h2",1),e.TgZ(2,"button",2),e.NdJ("click",function(){return i.setSelectedPaymentMethod()}),e.TgZ(3,"div",3),e.TgZ(4,"span",4),e._uU(5,"Cart\xe3o de cr\xe9dito"),e.qZA(),e._UZ(6,"img",5),e.qZA(),e.qZA(),e.qZA(),e.TgZ(7,"div",6),e.TgZ(8,"form",7),e.TgZ(9,"div",8),e.TgZ(10,"div",9),e.TgZ(11,"div",10),e.TgZ(12,"span",11),e._uU(13,"N\xfamero do cart\xe3o"),e.qZA(),e.TgZ(14,"div",12),e.TgZ(15,"div"),e._UZ(16,"i",13),e.qZA(),e.TgZ(17,"input",14),e.NdJ("keyup",function(){return i.validateCard()}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(18,"div",15),e.TgZ(19,"span",11),e._uU(20,"Validade"),e.qZA(),e.TgZ(21,"div",12),e._UZ(22,"i",16),e.TgZ(23,"input",17),e.NdJ("keyup",function(){return i.validateCard()}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(24,"div",18),e.TgZ(25,"span",11),e._uU(26,"CVC/CVV"),e.qZA(),e.TgZ(27,"div",12),e._UZ(28,"i",19),e.TgZ(29,"input",20),e.NdJ("keyup",function(){return i.validateCard()}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(30,"div",15),e.TgZ(31,"span",11),e._uU(32,"Titular"),e.qZA(),e.TgZ(33,"div",12),e._UZ(34,"i",21),e.TgZ(35,"input",22),e.NdJ("keyup",function(){return i.validateCard()}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(36,"div",10),e.TgZ(37,"span",11),e._uU(38,"Parcelas"),e.qZA(),e.TgZ(39,"div",12),e._UZ(40,"i",23),e.TgZ(41,"select",24),e.NdJ("change",function(o){return i.getSelectedInstallments(o)}),e.YNc(42,ve,2,0,"option",25),e.YNc(43,Ce,1,1,"ng-template",null,26,e.W1O),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(45,"span",27),e._UZ(46,"i",28),e._uU(47,"Compra 100% Segura"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&t){const a=e.MAs(44);e.xp6(8),e.Q6J("formGroup",i.creditCardForm),e.xp6(34),e.Q6J("ngIf",0==i.installments.length)("ngIfElse",a)}},directives:[s._Y,s.JL,s.sg,s.Fj,y.hx,s.JJ,s.u,s.nD,s.wO,s.EJ,h.O5,s.YN,s.Kr,h.sg],styles:[""]}),r})();var xe=m(4974);const be={validation:!1};let Ze=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[[h.ez,ue,y.yI.forRoot(be),s.UX,s.u5,pe.F,he.P]]}),r})();e.B6R(T,[h.O5,h.sg,s._Y,s.JL,s.sg,s.Fj,y.hx,s.JJ,s.u,s.nD,s.wO,s.EJ,s.YN,s.Kr,ye,xe.O,s.On],[h.JJ])}}]);